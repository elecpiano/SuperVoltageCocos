{"version":3,"sources":["../../../../assets/Script/assets/Script/GiftController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../assets/Script","sourcesContent":["import * as Enums from \"./Enums\";\nimport * as Global from \"./Global\";\nimport CellController from \"./CellController\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class GiftController extends cc.Component {\n\n    //#region Properties\n\n    @property(cc.Sprite)\n    GiftBody: cc.Sprite = null;\n\n    @property(cc.Sprite)\n    LongpressHint: cc.Sprite = null;\n\n    @property(cc.SpriteFrame)\n    Lightning_1: cc.SpriteFrame = null;\n    @property(cc.SpriteFrame)\n    Lightning_2: cc.SpriteFrame = null;\n    @property(cc.SpriteFrame)\n    Bomb: cc.SpriteFrame = null;\n    @property(cc.SpriteFrame)\n    BombStart: cc.SpriteFrame = null;\n    @property(cc.SpriteFrame)\n    BombStripe: cc.SpriteFrame = null;\n    \n    _GiftType: Enums.GiftType = Enums.GiftType.Lightning;\n    get GiftType() {\n        return this._GiftType;\n    }\n    set GiftType(type: Enums.GiftType) {\n        this._GiftType = type;\n        if (type == Enums.GiftType.Lightning) {\n            this.GiftBody.spriteFrame = this.Lightning_1;\n            this.LongpressHint.spriteFrame = this.Lightning_1;\n        }\n        else if (type == Enums.GiftType.Bomb) {\n            this.GiftBody.spriteFrame = this.Bomb;\n            this.LongpressHint.spriteFrame = this.Bomb;\n        }\n    }\n\n    //#endregion\n\n    //#region Lifecycle\n\n    // onLoad () {}\n\n    // start () {}\n\n    // update (dt) {}\n\n    //#endregion\n\n    //#region GameBoard Activity\n\n    Init(giftType: Enums.GiftType, cellToAttach: CellController){\n        this.GiftType = giftType;\n        this.AttachToCell(cellToAttach);\n    }\n\n    Burn(){\n        if (this.GiftType == Enums.GiftType.Bomb)\n        {\n            this.TriggerAsBomb();\n            return;\n        }\n\n        if (this.GiftType == Enums.GiftType.Lightning) {\n            this.discard();\n        }\n        \n        // var distance_x = (double)(Global.BOARD_COLUMN_COUNT - 1)/2 - this.AttachedToCell.Board_X;\n        // var distance_y = this.AttachedToCell.Board_Y + 1;\n        // var distance = Math.Sqrt(distance_x * distance_x + distance_y * distance_y);\n        // TimeSpan movementDuration = TimeSpan.FromMilliseconds( Global.GIFT_MOVEMENT_DURATION.TotalMilliseconds*distance/3);\n\n        // _Twinkle = PickUpATwinkle();\n\n        // CoreLogic.Gifts.Remove(this);\n\n        // MoveTo(CoreLogic.TopBar.Battery.Position, movementDuration,\n        //     (sender) =>\n        //     {\n        //         AttachedToCell = null;\n        //         ReturnATwinkle(_Twinkle);\n        //         _Twinkle = null;\n        //         this.GamePage.Components.Remove(this);\n\n        //         //Charge\n        //         CoreLogic.TopBar.Battery.Charge(this.ElectricQuantity);\n        //     });\n\n        // PlayGiftCollectionSoundeEffect();\n    }\n\n    //#endregion\n\n    //#region flicker\n\n    flicker_fadeout: boolean = true;\n    flicker(){\n        let action: cc.Action = this.flicker_fadeout ? \n                                cc.fadeTo(Global.GIFT_FLICKER_INTERVAL,64) : \n                                cc.fadeTo(Global.GIFT_FLICKER_INTERVAL,255);\n        this.node.runAction(action);\n        this.scheduleOnce(\n            ()=>{\n                this.flicker();\n            },Global.GIFT_FLICKER_INTERVAL);\n        this.flicker_fadeout = !this.flicker_fadeout;\n    }\n\n    //#endregion\n\n    //#region Cell Attachment\n\n    attachedCell: CellController = null;\n\n    _WhereItShouldBe: cc.Vec2 = new cc.Vec2(0,0);\n    get WhereItShouldBe() {\n        if (this.attachedCell != null) {\n            return this.attachedCell.WhereItShouldBe;\n        }\n        return this._WhereItShouldBe;\n    }\n\n    AttachToCell(cell:CellController){\n        this.attachedCell = cell;\n        cell.AttachedGift = this;\n    }\n\n    detachFromCell(){\n        if (this.attachedCell != null && this.attachedCell.AttachedGift == this) {\n            this.attachedCell.AttachedGift = null;\n            this.attachedCell = null;\n        }\n    }\n\n    Remove(){\n        this.unschedule(this.flicker);\n        this.detachFromCell();\n        this.node.parent.removeChild(this.node);\n    }\n\n    //#endregion\n\n    //#region Move\n\n    GIFT_MOVE_DURATION = 1;\n\n    GetReadyForShow(){\n        this.node.setPosition(this.attachedCell.Board_X * this.attachedCell.node.width + Global.BOARD_OFFSET_X, \n                              this.attachedCell.node.height * Global.BOARD_ROW_COUNT + Global.STARTING_LINE_OFFSET);\n    }\n\n    Award(selector: Function){\n        if (selector == null) {\n            this.node.runAction(cc.moveTo(this.GIFT_MOVE_DURATION, this.WhereItShouldBe));\n        }\n        else{\n            this.node.runAction(\n                cc.sequence(\n                    cc.moveTo(this.GIFT_MOVE_DURATION, this.WhereItShouldBe),\n                    cc.callFunc(selector, this)\n                )\n            );\n        }\n        this.flicker();\n    }\n\n    //#endregion\n\n    //#region Bomb\n\n    BombTriggered: boolean = false;\n    TriggerAsBomb(){\n        if (this.BombTriggered) {\n            return;\n        }\n        this.BombTriggered = true;\n        this.GiftBody.spriteFrame = this.BombStart;\n        this.GiftBody.node.runAction(\n            cc.scaleTo(Global.GIFT_MOVEMENT_DURATION, 0.5)\n        );\n        this.attachedCell.gameBoard.QueueTriggeredBomb(this);\n    }\n\n    //#endregion\n    \n    //#region Lightning\n\n    discard(){\n        this.node.runAction(\n            cc.sequence(\n                cc.scaleTo(Global.GIFT_MOVEMENT_DURATION, 0),\n                cc.callFunc(()=>this.Remove())\n            )\n        );\n    }\n\n    //#endregion\n\n    //#endregion Long Press\n\n    longpressHintAction: cc.Action = null;\n    longpressHintShown:boolean = false;\n    ShowLongPressHint(){\n        if (this.longpressHintAction == null) {\n            this.longpressHintAction = \n            cc.sequence(\n                cc.callFunc(()=>{\n                    this.LongpressHint.node.setScale(1);\n                    this.LongpressHint.node.opacity = 255;\n                }),\n                cc.spawn(\n                    cc.fadeOut(Global.GIFT_LONGPRESS_HINT_INTERVAL),\n                    cc.scaleTo(Global.GIFT_LONGPRESS_HINT_INTERVAL, 3)\n                ),\n                cc.callFunc(()=>{\n                    this.LongpressHint.node.setScale(1);\n                    this.LongpressHint.node.opacity = 255;\n                }),\n                cc.spawn(\n                    cc.fadeOut(Global.GIFT_LONGPRESS_HINT_INTERVAL),\n                    cc.scaleTo(Global.GIFT_LONGPRESS_HINT_INTERVAL, 3)\n                )\n            )\n        }\n\n        this.LongpressHint.node.runAction(this.longpressHintAction);\n        this.longpressHintShown = true;\n    }\n\n    StopLongPressHint(){\n        if (this.longpressHintShown) {\n            this.LongpressHint.node.stopAction(this.longpressHintAction);            \n        }\n        this.LongpressHint.node.setScale(1);\n        this.LongpressHint.node.opacity = 255;\n    }\n\n    LongPressFire(){\n        if (this.GiftType == Enums.GiftType.Lightning) {\n            this.attachedCell.gameBoard.BurnWithLightning(this.attachedCell);            \n        }\n        else if (this.GiftType == Enums.GiftType.Bomb) {\n            this.BombTriggered = true;\n            this.attachedCell.gameBoard.BombExplode(this);\n        }\n    }\n\n    //#endregion\n}\n"]}