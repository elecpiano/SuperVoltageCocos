{"version":3,"sources":["GiftController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"../../../../assets/Script","sourcesContent":["import * as Enums from \"./Enums\";\nimport * as Global from \"./Global\";\nimport CellController from \"./CellController\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class GiftController extends cc.Component {\n\n    //#region Properties\n\n    @property(cc.Sprite)\n    GiftBody: cc.Sprite = null;\n\n    // @property(cc.Sprite)\n    // LongpressHint: cc.Sprite = null;\n\n    @property(cc.SpriteFrame)\n    Lightning_1: cc.SpriteFrame = null;\n    @property(cc.SpriteFrame)\n    Lightning_2: cc.SpriteFrame = null;\n    @property(cc.SpriteFrame)\n    Bomb: cc.SpriteFrame = null;\n    @property(cc.SpriteFrame)\n    BombStart: cc.SpriteFrame = null;\n    @property(cc.SpriteFrame)\n    BombStripe: cc.SpriteFrame = null;\n    \n    _GiftType: Enums.GiftType = Enums.GiftType.Lightning;\n    get GiftType() {\n        return this._GiftType;\n    }\n    set GiftType(type: Enums.GiftType) {\n        this._GiftType = type;\n        if (type == Enums.GiftType.Lightning) {\n            this.GiftBody.spriteFrame = this.Lightning_1;\n            // this.LongpressHint.spriteFrame = this.Lightning_1;\n        }\n        else if (type == Enums.GiftType.Bomb) {\n            this.GiftBody.spriteFrame = this.Bomb;\n            // this.LongpressHint.spriteFrame = this.Bomb;\n        }\n    }\n\n    //#endregion\n\n    //#region Lifecycle\n\n    // onLoad () {}\n\n    // start () {}\n\n    // update (dt) {}\n\n    //#endregion\n\n    //#region GameBoard Activity\n\n    Init(giftType: Enums.GiftType, cellToAttach: CellController){\n        this.GiftType = giftType;\n        this.AttachToCell(cellToAttach);\n    }\n\n    Burn(){\n        if (this.GiftType == Enums.GiftType.Bomb) {\n            this.TriggerAsBomb();\n        }else if (this.GiftType == Enums.GiftType.Lightning) {\n            this.discard();\n        }\n    }\n\n    MonsterCollide(){\n        if (this.GiftType == Enums.GiftType.Bomb) {\n            // this.attachedCell.gameBoard.ManuallyExplode(this);   \n            this.TriggerAsBomb();         \n        }else if (this.GiftType == Enums.GiftType.Lightning) {\n            this.attachedCell.gameBoard.ManuallyBurn(this.attachedCell);            \n        }\n    }\n\n    //#endregion\n\n    //#region flicker\n\n    flicker_fadeout: boolean = true;\n    flicker_stopped: boolean = false;\n    flicker(){\n        let action: cc.Action = this.flicker_fadeout ? \n                                cc.fadeTo(Global.GIFT_FLICKER_INTERVAL,64) : \n                                cc.fadeTo(Global.GIFT_FLICKER_INTERVAL,255);\n        this.GiftBody.node.runAction(action);\n        this.scheduleOnce(\n            ()=>{\n                if (!this.flicker_stopped) {\n                    this.flicker();                    \n                }\n            },Global.GIFT_FLICKER_INTERVAL);\n        this.flicker_fadeout = !this.flicker_fadeout;\n    }\n\n    //#endregion\n\n    //#region Cell Attachment\n\n    attachedCell: CellController = null;\n\n    _WhereItShouldBe: cc.Vec2 = new cc.Vec2(0,0);\n    get WhereItShouldBe() {\n        if (this.attachedCell != null) {\n            return this.attachedCell.WhereItShouldBe;\n        }\n        return this._WhereItShouldBe;\n    }\n\n    AttachToCell(cell:CellController){\n        this.attachedCell = cell;\n        cell.AttachedGift = this;\n    }\n\n    detachFromCell(){\n        if (this.attachedCell != null && this.attachedCell.AttachedGift == this) {\n            this.attachedCell.AttachedGift = null;\n            this.attachedCell = null;\n        }\n    }\n\n    Remove(){\n        this.unschedule(this.flicker);\n        this.detachFromCell();\n        this.node.parent.removeChild(this.node);\n    }\n\n    //#endregion\n\n    //#region Move\n\n    GetReadyForShow(){\n        this.node.setPosition(this.attachedCell.Board_X * this.attachedCell.node.width + Global.BOARD_OFFSET_X, \n                              this.attachedCell.node.height * Global.BOARD_ROW_COUNT + Global.STARTING_LINE_OFFSET);\n    }\n\n    Award(selector: Function){\n        if (selector == null) {\n            this.node.runAction(cc.moveTo(Global.GIFT_MOVE_DURATION, this.WhereItShouldBe));\n        }\n        else{\n            this.node.runAction(\n                cc.sequence(\n                    cc.moveTo(Global.GIFT_MOVE_DURATION, this.WhereItShouldBe),\n                    cc.callFunc(selector, this)\n                )\n            );\n        }\n        this.flicker();\n    }\n\n    //#endregion\n\n    //#region Bomb\n\n    BombTriggered: boolean = false;\n    TriggerAsBomb(){\n        if (this.BombTriggered) {\n            return;\n        }\n        this.BombTriggered = true;\n        this.GiftBody.spriteFrame = this.BombStart;\n        this.GiftBody.node.runAction(\n            cc.sequence(\n                cc.scaleTo(Global.BURN_DURATION * 0.3, 1.3),\n                cc.scaleTo(Global.BURN_DURATION * 0.6, 0.5),\n                cc.callFunc(()=>this.node.opacity=0)\n            )\n        );\n        this.attachedCell.gameBoard.QueueTriggeredBomb(this);\n    }\n\n    //#endregion\n    \n    //#region Lightning\n\n    discard(){\n        this.node.runAction(\n            cc.sequence(\n                cc.scaleTo(Global.GIFT_MOVEMENT_DURATION, 0),\n                cc.callFunc(()=>this.Remove())\n            )\n        );\n    }\n\n    //#endregion\n\n    //#region Long Press\n\n    longpressHintAction: cc.Action = null;\n    longpressHintShown:boolean = false;\n    longpressFired:boolean = false;\n\n    ShowLongPressHint(){\n        this.attachedCell.gameBoard.ShowChargeEffect(this.GiftType, this.node.position);\n        // this.GiftBody.node.setScale(3);\n    }\n\n    StopLongPressHint(){\n        this.attachedCell.gameBoard.HideChargeEffect(this.GiftType);\n        // this.GiftBody.node.setScale(1);\n    }\n\n    LongPressFire(){\n        this.StopLongPressHint();\n        if (this.GiftType == Enums.GiftType.Lightning) {\n            this.attachedCell.gameBoard.ManuallyBurn(this.attachedCell);            \n        }\n        else if (this.GiftType == Enums.GiftType.Bomb) {\n            this.BombTriggered = true;\n            this.flicker_stopped = true;\n            this.node.opacity = 0;\n            this.attachedCell.gameBoard.ManuallyExplode(this);\n        }\n        this.longpressFired = true;\n    }\n\n    //#endregion\n}\n"]}